<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://cloudprober.org/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://cloudprober.org/fonts/vendor/jost/jost-v4-latin-500.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://cloudprober.org/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><link rel=stylesheet href=https://cloudprober.org/main.730f58f412cb539c040419690474bc09e34972e2d445ee61d1848f178b8fd1cb633ed9d64d8e31cef35996cce159d52f2cb72db86cdb5d77acdd88598e4d7c7a.css integrity="sha512-cw9Y9BLLU5wEBBlpBHS8CeNJcuLURe5h0YSPF4uP0ctjPtnWTY4xzvNZlszhWdUvLLctuGzbXXes3YhZjk18eg==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Targets Discovery - Cloudprober</title><meta name=description content="Automatic and continuous discovery of the targets is one of the core features of Cloudprober. This feature is specially critical for the dynamic environments that today&amp;rsquo;s cloud based deployments make possible. For exmaple, in a kubernetes cluster number of pods and their IPs can change on the fly, either in response to replica count changes or node failures. Automated targets discovery makes sure that we don&amp;rsquo;t have to reconfigure Cloudprober in response to such events."><link rel=canonical href=https://cloudprober.org/docs/how-to/targets/><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="Targets Discovery"><meta property="og:description" content="Automatic and continuous discovery of the targets is one of the core features of Cloudprober. This feature is specially critical for the dynamic environments that today&rsquo;s cloud based deployments make possible. For exmaple, in a kubernetes cluster number of pods and their IPs can change on the fly, either in response to replica count changes or node failures. Automated targets discovery makes sure that we don&rsquo;t have to reconfigure Cloudprober in response to such events."><meta property="og:url" content="https://cloudprober.org/docs/how-to/targets/"><meta property="og:site_name" content="Cloudprober"><meta property="article:published_time" content="2016-10-25T17:24:32-07:00"><meta property="article:modified_time" content="2016-10-25T17:24:32-07:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@cloudprober"><meta name=twitter:creator content="@manugarg"><meta name=twitter:title content="Targets Discovery"><meta name=twitter:description content><meta name=twitter:card content="summary"><meta name=twitter:image:alt content="Targets Discovery"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://cloudprober.org/#/schema/organization/1","name":"Cloudprober","url":"https://cloudprober.org/","sameAs":["https://twitter.com/cloudprober","https://github.com/cloudprober/cloudprober"],"logo":{"@type":"ImageObject","@id":"https://cloudprober.org/#/schema/image/1","url":"https://cloudprober.org/\u003cnil\u003e","width":512,"height":512,"caption":"Cloudprober"},"image":{"@id":"https://cloudprober.org/#/schema/image/1"}},{"@type":"WebSite","@id":"https://cloudprober.org/#/schema/website/1","url":"https://cloudprober.org/","name":"Cloudprober","description":"An active\/syntehtic monitoring software to reliably detect outages before your customers do.","publisher":{"@id":"https://cloudprober.org/#/schema/organization/1"}},{"@type":"WebPage","@id":"https://cloudprober.org/docs/how-to/targets/","url":"https://cloudprober.org/docs/how-to/targets/","name":"Targets Discovery","description":"","isPartOf":{"@id":"https://cloudprober.org/#/schema/website/1"},"about":{"@id":"https://cloudprober.org/#/schema/organization/1"},"datePublished":"2016-10-25T17:24:32CET","dateModified":"2016-10-25T17:24:32CET","breadcrumb":{"@id":"https://cloudprober.org/docs/how-to/targets/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://cloudprober.org/docs/how-to/targets/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://cloudprober.org/docs/how-to/targets/"]}]},{"@type":"BreadcrumbList","@id":"https://cloudprober.org/docs/how-to/targets/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://cloudprober.org","url":"https://cloudprober.org","name":"Home"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://cloudprober.org/docs/","url":"https://cloudprober.org/docs/","name":"Docs"}},{"@type":"ListItem","position":4,"item":{"@type":"WebPage","@id":"https://cloudprober.org/docs/how-to/","url":"https://cloudprober.org/docs/how-to/","name":"How To"}},{"@type":"ListItem","position":5,"item":{"@id":"https://cloudprober.org/docs/how-to/targets/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Article","@id":"https://cloudprober.org/#/schema/article/1","headline":"Targets Discovery","description":"","isPartOf":{"@id":"https://cloudprober.org/docs/how-to/targets/"},"mainEntityOfPage":{"@id":"https://cloudprober.org/docs/how-to/targets/"},"datePublished":"2016-10-25T17:24:32CET","dateModified":"2016-10-25T17:24:32CET","author":{"@id":"https://cloudprober.org/#/schema/person/2"},"publisher":{"@id":"https://cloudprober.org/#/schema/organization/1"},"image":{"@id":"https://cloudprober.org/docs/how-to/targets/#/schema/image/2"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"https://cloudprober.org/#/schema/person/2","name":"Manu Garg","sameAs":["https://twitter.com/manugarg","https://www.linkedin.com/in/manugarg/","https://github.com/manugarg"]}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://cloudprober.org/docs/how-to/targets/#/schema/image/2","url":null,"contentUrl":null,"caption":"Targets Discovery"}]}]}</script><meta name=theme-color content="#fff"><link rel=icon href=https://cloudprober.org/favicon.ico sizes=any><link rel=apple-touch-icon sizes=180x180 href=https://cloudprober.org/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://cloudprober.org/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://cloudprober.org/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=https://cloudprober.org/site.webmanifest><script async src="https://www.googletagmanager.com/gtag/js?id=G-FHHPC1TNQV"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-FHHPC1TNQV")</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-79661-8","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var buttons=document.querySelectorAll("a"),query;Array.prototype.map.call(buttons,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var t=e.getAttribute("data-action")||"follow";ga("send","event","outbound",t,e.href)})}),query=document.querySelector(".query"),query&&query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script></head><body class="docs single"><div class=sticky-top><div class=header-bar></div><header class="navbar navbar-expand-lg navbar-light doks-navbar"><nav class="container-xxl flex-wrap flex-lg-nowrap" aria-label="Main navigation"><a class="navbar-brand order-0" href=https://cloudprober.org/ aria-label=Cloudprober>Cloudprober</a>
<button class="btn btn-menu order-2 d-block d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasDoks aria-controls=offcanvasDoks aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class="offcanvas offcanvas-end border-0 py-lg-1" tabindex=-1 id=offcanvasDoks data-bs-backdrop=true aria-labelledby=offcanvasDoksLabel><div class="header-bar d-lg-none"></div><div class="offcanvas-header d-lg-none"><h2 class="h5 offcanvas-title ps-2" id=offcanvasDoksLabel><a class=text-dark href=https://cloudprober.org/>Cloudprober</a></h2><button type=button class="btn-close text-reset me-2" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class="offcanvas-body p-4 p-lg-0"><ul class="nav flex-column flex-lg-row align-items-lg-center mt-2 mt-lg-0 ms-lg-2 me-lg-auto"><li class=nav-item><a class="nav-link ps-0 py-1" href=https://cloudprober.org/docs/overview/getting-started>Get Started</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=https://cloudprober.org/docs/how-to/external-probe>How-Tos</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=https://cloudprober.org/docs/surfacers/overview>Exporting Metrics (Surfacers)</a></li></ul><hr class="text-black-50 my-4 d-lg-none"><form class="doks-search position-relative flex-grow-1 ms-lg-auto me-lg-2"><input id=search class="form-control is-search" type=search placeholder aria-label autocomplete=off><div id=suggestions class="shadow bg-white rounded d-none"></div></form><hr class="text-black-50 my-4 d-lg-none"><ul class="nav flex-column flex-lg-row"><li class=nav-item><a class="nav-link social-link" href=https://github.com/cloudprober/cloudprober><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><small class="ms-2 d-lg-none">GitHub</small></a></li><li class=nav-item><a class="nav-link social-link" href=https://join.slack.com/t/cloudprober/shared_invite/enQtNjA1OTkyOTk3ODc3LWQzZDM2ZWUyNTI0M2E4NmM4NTIyMjM5M2E0MDdjMmU1NGQ3NWNiMjU4NTViMWMyMjg0M2QwMDhkZGZjZmFlNGE><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22.08 9C19.81 1.41 16.54-.35 9 1.92S-.35 7.46 1.92 15 7.46 24.35 15 22.08 24.35 16.54 22.08 9z"/><line x1="12.57" y1="5.99" x2="16.15" y2="16.39"/><line x1="7.85" y1="7.61" x2="11.43" y2="18.01"/><line x1="16.39" y1="7.85" x2="5.99" y2="11.43"/><line x1="18.01" y1="12.57" x2="7.61" y2="16.15"/></svg><small class="ms-2 d-lg-none">Slack</small></a></li></ul><hr class="text-black-50 my-4 d-lg-none"><button id=mode class="btn btn-link" type=button aria-label="Toggle user interface mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></div></div></nav></header></div><div class=container-xxl><aside class=doks-sidebar><nav id=doks-docs-nav class="collapse d-lg-none" aria-label="Tertiary navigation"><h3 class="h6 text-uppercase mb-2">get-started</h3><ul class=list-unstyled><li><a class=docs-link href=https://cloudprober.org/docs/overview/cloudprober/>Overview</a></li><li><a class=docs-link href=https://cloudprober.org/docs/overview/getting-started/>Getting Started</a></li><li><a class=docs-link href=https://cloudprober.org/docs/overview/probe/>What is a Probe</a></li></ul><h3 class="h6 text-uppercase mb-2">how-to</h3><ul class=list-unstyled><li><a class=docs-link href=https://cloudprober.org/docs/how-to/external-probe/>External Probe</a></li><li><a class=docs-link href=https://cloudprober.org/docs/how-to/run-on-kubernetes/>Running On Kubernetes</a></li><li><a class=docs-link href=https://cloudprober.org/docs/how-to/additional-labels/>Additional Labels</a></li><li><a class=docs-link href=https://cloudprober.org/docs/how-to/validators/>Validators</a></li><li><a class=docs-link href=https://cloudprober.org/docs/how-to/percentiles/>Percentiles and Histograms</a></li><li><a class=docs-link href=https://cloudprober.org/docs/how-to/built-in-servers/>Built-in Servers</a></li><li><a class=docs-link href=https://cloudprober.org/docs/how-to/extensions/>Extending Cloudprober</a></li><li><a class="docs-link active" href=https://cloudprober.org/docs/how-to/targets/>Targets Discovery</a></li></ul><h3 class="h6 text-uppercase mb-2">surfacers</h3><ul class=list-unstyled><li><a class=docs-link href=https://cloudprober.org/docs/surfacers/overview/>Surfacers</a></li><li><a class=docs-link href=https://cloudprober.org/docs/surfacers/cloudwatch/>Cloudwatch (AWS Cloud Monitoring)</a></li><li><a class=docs-link href=https://cloudprober.org/docs/surfacers/stackdriver/>Stackdriver (Google Cloud Monitoring)</a></li></ul></nav></aside></div><div class="wrap container-xxl" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar d-none d-lg-block"><nav id=sidebar-default class=docs-links aria-label="Main navigation"><h3 class="h6 text-uppercase mb-2">get-started</h3><ul class=list-unstyled><li><a class=docs-link href=https://cloudprober.org/docs/overview/cloudprober/>Overview</a></li><li><a class=docs-link href=https://cloudprober.org/docs/overview/getting-started/>Getting Started</a></li><li><a class=docs-link href=https://cloudprober.org/docs/overview/probe/>What is a Probe</a></li></ul><h3 class="h6 text-uppercase mb-2">how-to</h3><ul class=list-unstyled><li><a class=docs-link href=https://cloudprober.org/docs/how-to/external-probe/>External Probe</a></li><li><a class=docs-link href=https://cloudprober.org/docs/how-to/run-on-kubernetes/>Running On Kubernetes</a></li><li><a class=docs-link href=https://cloudprober.org/docs/how-to/additional-labels/>Additional Labels</a></li><li><a class=docs-link href=https://cloudprober.org/docs/how-to/validators/>Validators</a></li><li><a class=docs-link href=https://cloudprober.org/docs/how-to/percentiles/>Percentiles and Histograms</a></li><li><a class=docs-link href=https://cloudprober.org/docs/how-to/built-in-servers/>Built-in Servers</a></li><li><a class=docs-link href=https://cloudprober.org/docs/how-to/extensions/>Extending Cloudprober</a></li><li><a class="docs-link active" href=https://cloudprober.org/docs/how-to/targets/>Targets Discovery</a></li></ul><h3 class="h6 text-uppercase mb-2">surfacers</h3><ul class=list-unstyled><li><a class=docs-link href=https://cloudprober.org/docs/surfacers/overview/>Surfacers</a></li><li><a class=docs-link href=https://cloudprober.org/docs/surfacers/cloudwatch/>Cloudwatch (AWS Cloud Monitoring)</a></li><li><a class=docs-link href=https://cloudprober.org/docs/surfacers/stackdriver/>Stackdriver (Google Cloud Monitoring)</a></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=d-xl-none><button class="btn btn-outline-primary btn-sm doks-toc-toggle collapsed" type=button data-bs-toggle=collapse data-bs-target=#onThisPage aria-controls=doks-docs-nav aria-expanded=false aria-label="Toggle On this page navigation">
<span></span>
<span><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></span></button><div class=collapse id=onThisPage><div class="card card-body mt-3 py-1"><div class=page-links><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#resource-discovery-service>Resource Discovery Service</a><ul><li><a href=#rds_server_options>rds_server_options</a></li><li><a href=#resource_path>resource_path</a></li><li><a href=#filter>filter</a></li></ul></li><li><a href=#running-rds-server>Running RDS Server</a></li></ul></nav></div></div></div></div><div class="page-links d-none d-xl-block"><h3></h3><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#resource-discovery-service>Resource Discovery Service</a><ul><li><a href=#rds_server_options>rds_server_options</a></li><li><a href=#resource_path>resource_path</a></li><li><a href=#filter>filter</a></li></ul></li><li><a href=#running-rds-server>Running RDS Server</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9 mx-xl-auto"><h1>Targets Discovery</h1><p class=lead></p><nav class=d-xl-none aria-label="Quaternary navigation"><div class=d-xl-none><button class="btn btn-outline-primary btn-sm doks-toc-toggle collapsed" type=button data-bs-toggle=collapse data-bs-target=#onThisPage aria-controls=doks-docs-nav aria-expanded=false aria-label="Toggle On this page navigation">
<span></span>
<span><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></span></button><div class=collapse id=onThisPage><div class="card card-body mt-3 py-1"><div class=page-links><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#resource-discovery-service>Resource Discovery Service</a><ul><li><a href=#rds_server_options>rds_server_options</a></li><li><a href=#resource_path>resource_path</a></li><li><a href=#filter>filter</a></li></ul></li><li><a href=#running-rds-server>Running RDS Server</a></li></ul></nav></div></div></div></div><div class="page-links d-none d-xl-block"><h3></h3><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#resource-discovery-service>Resource Discovery Service</a><ul><li><a href=#rds_server_options>rds_server_options</a></li><li><a href=#resource_path>resource_path</a></li><li><a href=#filter>filter</a></li></ul></li><li><a href=#running-rds-server>Running RDS Server</a></li></ul></nav></div></nav><p>Automatic and continuous discovery of the targets is one of the core features of
Cloudprober. This feature is specially critical for the dynamic environments that today&rsquo;s cloud based deployments make possible. For exmaple, in a kubernetes cluster number of pods and their IPs can change on the fly, either in response to replica count changes or node failures. Automated targets discovery makes sure that we don&rsquo;t have to reconfigure Cloudprober in response to such events.</p><h2 id=overview>Overview <a href=#overview class=anchor aria-hidden=true>#</a></h2><p>The main idea behind Cloudprober&rsquo;s targets discovery is to use an independent source of truth to figure out the targets we are supposed to monitor. This source of truth is usually the resource provider&rsquo;s API, for example, GCE API and Kubernetes API. Cloudprober periodically polls these APIs to get the latest list of resources.</p><p>Example targets configuration:</p><pre><code class=language-bash>targets {
  rds_targets {
    # Monitor all endpoints for the service service-a
    resource_path: &quot;k8s://endpoints/service-a&quot;
  }
}
</code></pre><p>Some salient features of the cloudprober&rsquo;s targets discovery:</p><ul><li>Continuous discovery. We don&rsquo;t just discover targets in the beginning, but keep refreshing them at a regular interval.</li><li>Protection against the upstream provider failures. If refreshing of the targets fails during one of the refresh cycles, we continue using the existing set of targets.</li><li>Targets data includes name, labels, IP and ports (labels and ports are optional). These details allow configuring probes, for example, automatically setting port in the HTTP probe, and using target lables for probe results labeling.</li><li>Well-defined protobuf based API (RDS &ndash; more on it below) to add support for more target types.</li><li>Currently supports GCE and Kubernetes resources. Adding more resource types should be straightforward.</li></ul><p>Cloudprober currently (<strong>as of v0.10.7</strong>) supports following types of dynamic targets:</p><table><thead><tr><th>Resource Provider</th><th>Resource Types</th></tr></thead><tbody><tr><td>Kubernetes (k8s)</td><td>pods, endpoints, services, ingresses</td></tr><tr><td>GCP (gcp)</td><td>gce_instances, pubsub_messages</td></tr></tbody></table><h2 id=resource-discovery-service>Resource Discovery Service <a href=#resource-discovery-service class=anchor aria-hidden=true>#</a></h2><p>To provide a consistent interface between targets&rsquo; configuration and the actual implementation, Cloudprober defines and uses a protocol called RDS (Resource Discovery Service). Cloudprober&rsquo;s targets module includes a targets type &ldquo;rds_targets&rdquo;, that talks to an RDS backend that is either part of the same process or available over gRPC.</p><p><a href=rds_targets.png><img style=float:center width=450px src=rds_targets.png></a></p><p>Here are the RDS targets configuration (<a href=https://github.com/cloudprober/cloudprober/blob/86a1d1fcd2f8505c45ff462d69458fd5b9964e5f/targets/proto/targets.proto#L12>RDSTargets</a>) options:</p><pre><code class=language-proto>message RDSTargets {
  // RDS server options, for example:
  // rds_server_options {
  //   server_address: &quot;rds-server.xyz:9314&quot;
  //   oauth_config: {
  //     ...
  //   }
  // }
  // Default is to use the local server if any.
  optional rds.ClientConf.ServerOptions rds_server_options = 1;

  // Resource path specifies the resources to return. Resources paths have the
  // following format:
  // &lt;resource_provider&gt;://&lt;resource_type&gt;/&lt;additional_params&gt;
  //
  // Examples:
  // For GCE instances in projectA: &quot;gcp://gce_instances/&lt;projectA&gt;&quot;
  // Kubernetes Pods : &quot;k8s://pods&quot;
  optional string resource_path = 2;

  // Filters to filter resources by. Example:
  // filter {
  //   key: &quot;namespace&quot;
  //   value: &quot;mynamesspace&quot;
  // }
  // filter {
  //   key: &quot;labels.app&quot;
  //   value: &quot;web-service&quot;
  // }
  repeated rds.Filter filter = 3;

  // IP config to specify the IP address to pick for a resource. IPConfig
  // is defined here:
  // https://github.com/cloudprober/cloudprober/blob/master/rds/proto/rds.proto
  optional rds.IPConfig ip_config = 4;
}
</code></pre><p>Most options are explained in the comments for quick references. Here is the further explanation of some of these options:</p><h3 id=rds_server_options>rds_server_options <a href=#rds_server_options class=anchor aria-hidden=true>#</a></h3><p>This <a href=https://github.com/cloudprober/cloudprober/blob/86a1d1fcd2f8505c45ff462d69458fd5b9964e5f/rds/client/proto/config.proto#L19>field</a> specifies how to connect to the RDS server: server address and security options (OAuth and TLS). If left unspecified, it connects to the local server if any (started through <code>rds_server</code> option). Next up it looks for the <code>rds_server_options</code> in <a href=https://github.com/cloudprober/cloudprober/blob/86a1d1fcd2f8505c45ff462d69458fd5b9964e5f/targets/proto/targets.proto#L125>global_targets_options</a>.</p><h3 id=resource_path>resource_path <a href=#resource_path class=anchor aria-hidden=true>#</a></h3><p>Resource path specifies the resources we are interested in. It consists of <em>resource provider</em>, <em>resource type</em> and optional <em>relative path</em>: <code>&lt;resource_provider>://&lt;resource_type>/&lt;optional_relative_path></code></p><ul><li><code>resource_provider</code>: Resource provider is a generic concept within the RDS protocol but usually maps to the cloud provider. Cloudprober RDS server currently implements the Kubernetes (k8s) and GCP (gcp) resource providers. We plan to add more resource providers in future.</li><li><code>resource_type</code>: Available resource types depend on the providers, for example, for k8s provider supports the following resource types: <em>pods</em>, <em>endpoints</em>, and <em>services</em>.</li><li><code>optional_relative_path</code>: For most resource types you can specify resource name in the resource path itself, e.g. <code>k8s://services/cloudprober</code>. Alternatively, you can use filters to filter by name, resource, etc.</li></ul><h3 id=filter>filter <a href=#filter class=anchor aria-hidden=true>#</a></h3><p>Filters are key-value strings that can be used to filter resources by various fields. Filters depend on the resource types, but most resources support filtering by name and labels.</p><pre><code># Return resources that start with &quot;web&quot; and have label &quot;service:service-a&quot;
...
 filter {
   key: &quot;name&quot;
   value: &quot;^web.*&quot;
 }
 filter {
   key: &quot;labels.service&quot;
   value: &quot;service-a&quot;
 }
</code></pre><ul><li>Filters supported by kubernetes resources: <a href=https://github.com/cloudprober/cloudprober/blob/e4a0321d38d75fb4655d85632b52039fa7279d1b/rds/kubernetes/kubernetes.go#L55>k8s filters</a>.</li><li>Filters supported by GCP:<ul><li><a href=https://github.com/cloudprober/cloudprober/blob/e4a0321d38d75fb4655d85632b52039fa7279d1b/rds/gcp/gce_instances.go#L44>GCE Instances</a></li><li><a href=https://github.com/cloudprober/cloudprober/blob/e4a0321d38d75fb4655d85632b52039fa7279d1b/rds/gcp/pubsub.go#L34>Pub/Sub Messages</a></li></ul></li></ul><h2 id=running-rds-server>Running RDS Server <a href=#running-rds-server class=anchor aria-hidden=true>#</a></h2><p>RDS server can either be run as an independent process or it can be part of the main prober process. Former mode is useful for large deployments where you may want to reduce the API upcall traffic (for example, to GCP). For example, if you run 1000+ prober processes, it will be much more economical, from the API quota usage point of view, to have a centralized RDS service with much fewer (2-3) instances instead of having each prober process make its own API calls.</p><p>RDS server can be added to a cloudprober process using the <code>rds_server</code> stanza. If you&rsquo;re running RDS server in a remote process, you&rsquo;ll have to enable gRPC server in that process (using <code>grpc_port</code>) so that other instances can access it remotely.</p><p>Here is an example RDS server configuration:</p><pre><code class=language-shell>rds_server {
  # GCP provider to discover GCP resources.
  provider {
    gcp_config {
      # Projects to discover resources in.
      project: &quot;test-project-1&quot;
      project: &quot;test-project-2&quot;

      # Discover GCE instances in us-central1.
      gce_instances {
        zone_filter: &quot;name = us-central1-*&quot;
        re_eval_sec: 60  # How often to refresh, default is 300s.
      }

      # GCE forwarding rules.
      forwarding_rules {}
    }
  }

  # Kubernetes targets are further discussed at:
  # https://cloudprober.org/how-to/run-on-kubernetes/#kubernetes-targets
  provider {
    kubernetes_config {
      endpoints {}
    }
  }
}

# Enable gRPC server for RDS. Only required for remote access to RDS server.
grpc_port: 9314
</code></pre><p>For the remote RDS server setup, if accessing over external network, you can secure the underlying gRPC communication using <a href=https://github.com/cloudprober/cloudprober/blob/master/config/proto/config.proto#L91>TLS certificates</a>.</p><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"></div><div class="docs-navigation d-flex justify-content-between"><a href=https://cloudprober.org/docs/how-to/percentiles/><div class="card my-1"><div class="card-body py-2">&larr; Percentiles, Histograms, and Distributions</div></div></a><a class=ms-auto href=https://cloudprober.org/docs/how-to/built-in-servers/><div class="card my-1"><div class="card-body py-2">Built-in Servers &rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class=container-xxl><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Website powered by <a class=text-muted href=https://gohugo.io/>Hugo</a>, and <a class=text-muted href=https://getdoks.org/>Doks</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline></ul></div></div></div></footer><script src=https://cloudprober.org/js/bootstrap.min.87685cf4e6585276ff9e7b5d0b97e792615af6921e77821315d1ca7c5511ac2f30667e16c0d031e680ca8b57f63f6c0f6c4a232da777cce474b501ed81e090a9.js integrity="sha512-h2hc9OZYUnb/nntdC5fnkmFa9pIed4ITFdHKfFURrC8wZn4WwNAx5oDKi1f2P2wPbEojLad3zOR0tQHtgeCQqQ==" crossorigin=anonymous defer></script>
<script src=https://cloudprober.org/js/highlight.min.6d2ae9724e2da3febf052f9f9979776c542ecb50cd20d7280148c1eef7d0f76d3d84f82b8d3b10a209294618236691747c95c658e350ffac326cde26caf84347.js integrity="sha512-bSrpck4to/6/BS+fmXl3bFQuy1DNINcoAUjB7vfQ9209hPgrjTsQogkpRhgjZpF0fJXGWONQ/6wybN4myvhDRw==" crossorigin=anonymous defer></script>
<script src=https://cloudprober.org/main.min.162c56a0426544de0d010e66c56e321579655c400c9aae06a6823e7682de379adadf2165bd416fea191e4e7e410fbf1fd2c35a759aa43ff2e3787067669bf81b.js integrity="sha512-FixWoEJlRN4NAQ5mxW4yFXllXEAMmq4GpoI+doLeN5ra3yFlvUFv6hkeTn5BD78f0sNadZqkP/LjeHBnZpv4Gw==" crossorigin=anonymous defer></script>
<script src=https://cloudprober.org/index.min.8e7807adfb9a6cee9c3e12c3532154c232a5bfe81cfda9e6f5b532932ac5d4e9092fd8ef5f19322c45e0799a1588decf7b367f472116dfb90a83afdb2a182489.js integrity="sha512-jngHrfuabO6cPhLDUyFUwjKlv+gc/anm9bUykyrF1OkJL9jvXxkyLEXgeZoViN7PezZ/RyEW37kKg6/bKhgkiQ==" crossorigin=anonymous defer></script></body></html>