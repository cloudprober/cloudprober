# This config demonstrates AWS EC2 instance discovery using the RDS server.
#
# This example discovers EC2 instances in the us-east-1 region and probes them
# using HTTP. Cloudprober will automatically discover new instances and remove
# terminated instances based on the re_eval_sec interval.
#
# Prerequisites:
# - AWS credentials configured (via environment variables, credentials file, or IAM role)
# - EC2 instances running in the specified region
#
# Run with:
#   cloudprober --config_file=ec2_instances.cfg
#
# Expected output format:
# total{ptype="http",probe="ec2-http",dst="i-1234567890abcdef0"} 20
# success{ptype="http",probe="ec2-http",dst="i-1234567890abcdef0"} 18

# Configure RDS server with AWS provider
rds_server {
  provider {
    aws_config {
      # AWS region to discover resources in
      region: "us-east-1"

      # Optional: Use a specific AWS profile
      # profile_name: "my-aws-profile"

      # Enable EC2 instance discovery
      ec2_instances {
        # Refresh instance list every 5 minutes
        re_eval_sec: 300
      }
    }
  }
}

# Probe EC2 instances
probe {
  name: "ec2-http"
  type: HTTP

  targets {
    rds_targets {
      resource_path: "aws://ec2_instances"
    }
  }

  http_probe {
    # Probe the root path
    relative_url: "/"

    # Use port 80
    port: 80
  }

  # Run probe every 30 seconds
  interval_msec: 30000
  timeout_msec: 5000
}
