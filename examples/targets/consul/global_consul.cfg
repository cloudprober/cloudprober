# Example demonstrating global Consul configuration
#
# This shows how to configure Consul settings globally so they can be shared
# across multiple probes without repeating the configuration.
#
# Advanced Features (not shown in this basic example):
#
# - TLS Configuration: Add a tls{} block to global_consul_options{} for secure connections.
#   See internal/rds/consul/proto/global.proto for TLSConfig options (ca_file, cert_file, key_file).
#
# - Kubernetes Auto-Discovery: Set address: "auto-discover" (or CONSUL_HTTP_ADDR="auto-discover")
#   to automatically discover Consul service in Kubernetes. Optionally add a kubernetes_service{}
#   block to customize namespace, service_name, and port.
#
# - Environment Variables: All standard Consul environment variables are supported
#   (CONSUL_HTTP_ADDR, CONSUL_HTTP_TOKEN, CONSUL_CACERT, CONSUL_DATACENTER, etc.).
#   Configuration values take precedence over environment variables.

# Configure Consul connection globally for all Consul-based targets
global_targets_options {
  global_consul_options {
    # Consul server address (can be overridden per-probe)
    address: "localhost:8500"

    # Optional: Consul datacenter
    datacenter: "dc1"

    # Optional: Consul ACL token
    # Can also be set via CONSUL_HTTP_TOKEN environment variable
    # token: "your-acl-token-here"
  }
}

# Probe 1: Uses global Consul configuration
probe {
  name: "web_services"
  type: HTTP

  targets {
    consul {
      # address is inherited from global_consul_options
      services: "web-.*"
      health_status: "passing"
    }
  }

  http_probe {
    relative_url: "/health"
  }

  interval_msec: 10000
}

# Probe 2: Also uses global configuration but overrides the address
probe {
  name: "api_services"
  type: HTTP

  targets {
    consul {
      # Override the global address for this specific probe
      address: "consul-api.example.com:8500"
      services: "api-.*"
      tags: "production"
      health_status: "passing"
    }
  }

  http_probe {
    relative_url: "/api/health"
  }

  interval_msec: 15000
}

# Export metrics to Prometheus
surfacer {
  type: PROMETHEUS
}
