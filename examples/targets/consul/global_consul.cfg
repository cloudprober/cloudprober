# Example demonstrating global Consul configuration
#
# This shows how to configure Consul settings globally so they can be shared
# across multiple probes without repeating the configuration.

# Configure Consul connection globally for all Consul-based targets
global_targets_options {
  global_consul_options {
    # Consul server address (can be overridden per-probe)
    address: "localhost:8500"

    # Optional: Consul datacenter
    datacenter: "dc1"

    # Optional: Consul ACL token
    # Can also be set via CONSUL_HTTP_TOKEN environment variable
    # token: "your-acl-token-here"
  }
}

# Probe 1: Uses global Consul configuration
probe {
  name: "web_services"
  type: HTTP

  targets {
    consul {
      # address is inherited from global_consul_options
      services: "web-.*"
      health_status: "passing"
    }
  }

  http_probe {
    relative_url: "/health"
  }

  interval_msec: 10000
}

# Probe 2: Also uses global configuration but overrides the address
probe {
  name: "api_services"
  type: HTTP

  targets {
    consul {
      # Override the global address for this specific probe
      address: "consul-api.example.com:8500"
      services: "api-.*"
      tags: "production"
      health_status: "passing"
    }
  }

  http_probe {
    relative_url: "/api/health"
  }

  interval_msec: 15000
}

# Export metrics to Prometheus
surfacer {
  type: PROMETHEUS
}
