# Register Cloudprober instance with Consul
#
# This configuration registers the Cloudprober instance as a service in Consul,
# making it discoverable by other services and monitoring tools.
#
# Advanced Features (not shown in this basic example):
#
# - TLS Configuration: Add a tls{} block to consul_surfacer{} for secure connections.
#   See internal/rds/consul/proto/global.proto for TLSConfig options (ca_file, cert_file, key_file).
#
# - Kubernetes Auto-Discovery: Set address: "auto-discover" (or CONSUL_HTTP_ADDR="auto-discover")
#   to automatically discover Consul service in Kubernetes. Optionally add a kubernetes_service{}
#   block to customize namespace, service_name, and port.
#
# - System Variables (sysvars): Cloudprober automatically publishes system information as Consul
#   service metadata (hostname, version, etc.). This is enabled by default.
#   - To filter which sysvars to publish: Add include_vars: "pattern" or exclude_vars: "pattern"
#   - To disable sysvars: Add publish_sysvars: false to consul_surfacer{}
#
# - Environment Variables: All standard Consul environment variables are supported
#   (CONSUL_HTTP_ADDR, CONSUL_HTTP_TOKEN, CONSUL_CACERT, CONSUL_DATACENTER, etc.).
#   Configuration values take precedence over environment variables.

# Consul surfacer - registers this Cloudprober instance with Consul
surfacer {
  type: CONSUL

  consul_surfacer {
    # Consul server address
    address: "localhost:8500"

    # Service registration configuration
    service {
      name: "cloudprober"

      # Service tags for discovery
      tags: "monitoring"
      tags: "cloudprober"

      # Port where cloudprober serves metrics (default: 9313)
      port: 9313
    }

    # Health check configuration
    health_check {
      # HTTP endpoint for health checks
      http_endpoint: "/health"

      # Check interval
      interval: "10s"

      # Timeout for health checks
      timeout: "5s"

      # Deregister service after this duration if unhealthy
      deregister_critical_service_after: "1m"
    }

    # Optional: Custom metadata
    metadata {
      key: "environment"
      value: "production"
    }
  }
}
