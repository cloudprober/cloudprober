# Register Cloudprober instance with Consul
#
# This configuration registers the Cloudprober instance as a service in Consul,
# making it discoverable by other services and monitoring tools.

# Example probe (required for cloudprober to run)
probe {
  name: "google_homepage"
  type: HTTP
  targets {
    host_names: "www.google.com"
  }
  http_probe {}
  interval_msec: 5000
}

# Consul surfacer - registers this Cloudprober instance with Consul
surfacer {
  type: CONSUL

  consul_surfacer {
    # Consul server address
    address: "localhost:8500"

    # Service registration configuration
    service {
      name: "cloudprober"

      # Service tags for discovery
      tags: "monitoring"
      tags: "cloudprober"

      # Port where cloudprober serves metrics (default: 9313)
      port: 9313
    }

    # Health check configuration
    health_check {
      # HTTP endpoint for health checks
      http_endpoint: "/status"

      # Check interval
      interval: "10s"

      # Timeout for health checks
      timeout: "5s"

      # Deregister service after this duration if unhealthy
      deregister_critical_service_after: "1m"
    }

    # Optional: Custom metadata
    metadata {
      key: "environment"
      value: "production"
    }
  }
}

# Also export metrics to Prometheus
surfacer {
  type: PROMETHEUS
}
