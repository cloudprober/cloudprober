syntax = "proto2";

package cloudprober.surfacer.prometheus;

option go_package = "github.com/cloudprober/cloudprober/surfacers/internal/prometheus/proto";

message SurfacerConf {
  // How many metrics entries (EventMetrics) to buffer. Incoming metrics
  // processing is paused while serving data to prometheus. This buffer is to
  // make writes to prometheus surfacer non-blocking.
  // NOTE: This field is confusing for users and will be removed from the config
  // after v0.10.3.
  optional int64 metrics_buffer_size = 1 [default = 10000];

  // Whether to include timestamps in metrics. By default, we include
  // timestamps only for gauge metrics as they represent the value at a certain
  // point in time.
  //
  // If explicitly enabled, timestamp will be attached to all metrics,
  // including counters. If explicitly disabled, timestamp will not be attached
  // to gauges as well.
  //
  // As it's typically useful to set this across the deployment, this field can
  // also be set through the command line flag --prometheus_include_timestamp.
  // If both are set, the config value takes precedence.
  optional bool include_timestamp = 2;

  // Whether to disable all metrics expiration.
  //
  // Default behavior (recommended):
  // By default, our goal is to expire timestamped metrics, which are more
  // than 10 minutes old (see why below). If include_timestamp is not explicitly
  // set to true or false, only gauge metrics will have timestamps, and only
  // they will be expired. Similarly, if include_timestamp is explicitly set to
  // false, no metrics will be expired, and if include_timestamp is explicitly
  // set to true, all metrics will be expired.
  //
  // Why do we expire timestamped metrics? Prometheus generates warnings while
  // scraping metrics that have timestamps that are more than 10m old.
  optional bool disable_metrics_expiration = 5;

  // URL that prometheus scrapes metrics from.
  optional string metrics_url = 3 [default = "/metrics"];

  // Prefix to add to all metric names. For example setting this field to
  // "cloudprober_" will result in metrics with names:
  // cloudprober_total, cloudprober_success, cloudprober_latency, ..
  //
  // As it's typically useful to set this across the deployment, this field can
  // also be set through the command line flag --prometheus_metrics_prefix. If
  // both are set, the config value takes precedence.
  optional string metrics_prefix = 4;
}
